// Used in make_it_modular.js
var fs = require('fs');
var path = require('path');

// Make a list of files in given directory that match the filter extension
//   @param  dir_path  the given directory to filter
//   @param  filer     the extension filter (only include these files)
//   @warn  .lsFilter  won't pass the test (just better coding convention)
module.exports.lsFilter = function(dir_path, filter, callback) {
  fs.readdir(dir_path, function doneReadDir(err, list) {
    if (err)
      return callback(err);
    var filtered_list = [];
    list.forEach(function(val, index) {
      if (fileExtCmp(filter, path.extname(val))) {
        // list.splice(index, 1);
        filtered_list.push(val);
      }
    });
    callback(null, filtered_list);
  });
};

// Compare file name strings to each other
//   @param  ext            the file name extension (from filter)
//   @param  file_with_dot  the actual file name extension
//                          with a dot prefix
//   @return  true  when names match (excluding prefix dot)
function fileExtCmp(ext, file_with_dot) {
  var len = file_with_dot.length - 1;
  if (ext.length != len)
    return false;

  for (x = 0; x < len; ++x) {
    if (ext[x] != file_with_dot[x+1])
      return false;
  }
  return true;
}
